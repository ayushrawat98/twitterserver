import{a as T}from"./chunk-VJFUVKBI.js";import{a as g,b as M}from"./chunk-5GU24SDZ.js";import{Aa as b,B as a,C as d,G as m,H as u,J as h,M as n,N as s,O as P,P as _,Q as f,R as r,W as v,_ as x,g as S,p as C,t as c,u as p}from"./chunk-XZJSOPHC.js";function A(i,t){if(i&1){let e=_();n(0,"app-textarea",5),f("sendText",function(l){c(e);let y=r();return p(y.add(l))}),s()}if(i&2){let e=r();u("disablePostButton",e.disablePostButton)}}function O(i,t){i&1&&(n(0,"p",2),v(1,"Login to post"),s())}function B(i,t){if(i&1){let e=_();n(0,"button",6),f("click",function(){c(e);let l=r();return p(l.loadOlder())}),v(1,"Load Older"),s()}}var w=class i{constructor(t,e){this._postService=t;this._authService=e}allPosts=[];hideLoadMore=!1;disablePostButton=!1;ngOnInit(){this._postService.mainCache.post.length!=0?this.allPosts=[...this._postService.mainCache.post]:this.getAllPosts("up")}getAllPosts(t){this._postService.getAllPosts(this._authService.userdata()?.id??null,t).subscribe({next:e=>{t=="up"?(this.allPosts=e,this._postService.mainCache.pageno=0,this.hideLoadMore=!1):(Array.isArray(e)&&e.length==0&&(this.hideLoadMore=!0,this._postService.mainCache.pageno--),this.allPosts=[...this.allPosts,...e])}})}add(t){this.disablePostButton=!0,this._postService.addNewPost({content:t.content,parentpostid:null,file:t.file}).pipe(S(1e3)).subscribe({next:e=>{this.getAllPosts("up"),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success")},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail")}})}loadOlder(){this._postService.mainCache.pageno++,this.getAllPosts("down")}ngOnDestroy(){this._postService.mainCache.post=[...this.allPosts]}static \u0275fac=function(e){return new(e||i)(d(g),d(b))};static \u0275cmp=C({type:i,selectors:[["app-main"]],standalone:!0,features:[x],decls:5,vars:4,consts:[[1,"container"],["placeholderText","What is happening?",3,"disablePostButton"],[1,"text-area-p"],[3,"list","showSeperator"],[1,"center-block"],["placeholderText","What is happening?",3,"sendText","disablePostButton"],[1,"center-block",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0),m(1,A,1,1,"app-textarea",1)(2,O,2,0,"p",2),P(3,"app-postlist",3),m(4,B,2,0,"button",4),s()),e&2&&(a(),h(o._authService.userdata()?1:2),a(2),u("list",o.allPosts)("showSeperator",!1),a(),h(o.hideLoadMore?-1:4))},dependencies:[M,T]})};export{w as MainComponent};
