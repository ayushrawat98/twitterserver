import{a as y}from"./chunk-NLUVHEKY.js";import{a as M,b as T}from"./chunk-6GAUQJJ6.js";import{C as a,Ca as g,D as d,H as m,I as u,K as h,O as n,P as s,Q as x,R as _,S as f,T as r,Y as v,aa as b,g as S,h as C,q as P,u as c,v as p}from"./chunk-7YCM2XEO.js";function O(i,t){if(i&1){let e=_();n(0,"app-textarea",5),f("sendText",function(l){c(e);let A=r();return p(A.add(l))}),s()}if(i&2){let e=r();u("disablePostButton",e.disablePostButton)}}function B(i,t){i&1&&(n(0,"p",2),v(1,"Login to post"),s())}function D(i,t){if(i&1){let e=_();n(0,"button",6),f("click",function(){c(e);let l=r();return p(l.loadOlder())}),v(1,"Load Older"),s()}}var w=class i{constructor(t,e){this._postService=t;this._authService=e}allPosts=[];hideLoadMore=!1;disablePostButton=!1;ngOnInit(){this._postService.mainCache.post.length!=0?this.allPosts=[...this._postService.mainCache.post]:this.getAllPosts()}getAllPosts(){this._postService.getAllPosts(this._authService.userdata()?.id??null).pipe(C(1e3)).subscribe({next:t=>{Array.isArray(t)&&t.length==0&&(this.hideLoadMore=!0,this._postService.mainCache.pageno--),this.allPosts=[...this.allPosts,...t]}})}add(t){this.disablePostButton=!0,this._postService.addNewPost({content:t.content,parentpostid:null,file:t.file}).pipe(S(1e3)).subscribe({next:e=>{this.getAllPosts(),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success")},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail")}})}loadOlder(){this._postService.mainCache.pageno++,this.getAllPosts()}ngOnDestroy(){this._postService.mainCache.post=[...this.allPosts]}static \u0275fac=function(e){return new(e||i)(d(M),d(g))};static \u0275cmp=P({type:i,selectors:[["app-main"]],standalone:!0,features:[b],decls:5,vars:4,consts:[[1,"container"],["placeholderText","What is happening?",3,"disablePostButton"],[1,"text-area-p"],[3,"list","showSeperator"],[1,"center-block"],["placeholderText","What is happening?",3,"sendText","disablePostButton"],[1,"center-block",3,"click"]],template:function(e,o){e&1&&(n(0,"div",0),m(1,O,1,1,"app-textarea",1)(2,B,2,0,"p",2),x(3,"app-postlist",3),m(4,D,2,0,"button",4),s()),e&2&&(a(),h(o._authService.userdata()?1:2),a(2),u("list",o.allPosts)("showSeperator",!1),a(),h(o.hideLoadMore?-1:4))},dependencies:[T,y]})};export{w as MainComponent};
