import{a as v}from"./chunk-DQ3HOWQ2.js";import"./chunk-IHDMNEHU.js";import{a as O,b as A}from"./chunk-33Z2X7YL.js";import{Aa as M,B as r,C as s,Ca as N,G as C,H as p,Ha as V,J as u,M as a,N as l,O as f,P as b,Q as _,R as c,S as P,T as S,U as w,W as h,ba as y,o as g,s as d,t as m,ua as T}from"./chunk-K4OJKT4O.js";function j(i,t){if(i&1){let e=b();a(0,"app-textarea",5,0),_("sendText",function(n){d(e);let x=c();return m(x.add(n))}),l()}if(i&2){let e=c();p("placeholderText","What is happening?")("disablePostButton",e.disablePostButton)}}function B(i,t){i&1&&(a(0,"p",3),h(1,"Login to post"),l())}function R(i,t){i&1&&f(0,"br")(1,"progress",6)}function k(i,t){i&1&&f(0,"div",4)}function D(i,t){if(i&1){let e=b();f(0,"app-postlist",7),a(1,"div",8)(2,"button",9),_("click",function(){d(e);let n=c();return m(n.loadNew())}),h(3,"Load New"),l(),a(4,"button",9),_("click",function(){d(e);let n=c();return m(n.loadOld())}),h(5,"Load Older"),l()()}if(i&2){let e=c();p("list",e.allPosts)("showSeperator",!1),r(2),p("disabled",e.pageNumber==0),r(2),p("disabled",e.allPosts[e.allPosts.length-1]&&e.allPosts[e.allPosts.length-1].id==1)}}var I=class i{constructor(t,e,o,n,x){this._postService=t;this._authService=e;this.viewportScroller=o;this.route=n;this.router=x}allPosts=[];pageNumber=0;disablePostButton=!1;loading=!1;showProgress=!1;textarea;ngOnInit(){this.route.paramMap.subscribe(t=>{this.pageNumber=Number(t.get("page")),this.getAllPosts(Number(t.get("page")))})}getAllPosts(t){this.loading=!0,this._postService.getAllPosts(this._authService.userdata()?.id??null,t??0).subscribe({next:e=>{this.allPosts=e,this.viewportScroller.scrollToPosition([0,0]),this.loading=!1}})}add(t){this.disablePostButton=!0,this.showProgress=!0,this._postService.addNewPost({content:t.content,parentpostid:null,file:t.file}).pipe().subscribe({next:e=>{this.pageNumber=0,this.getAllPosts(0),this.disablePostButton=!1,this._postService.postSuccessSubject.next("success"),this.showProgress=!1,this.textarea.reset()},error:e=>{alert(e.error),this.disablePostButton=!1,this._postService.postSuccessSubject.next("fail"),this.showProgress=!1}})}loadNew(){this.pageNumber--,this.router.navigate(["main",this.pageNumber])}loadOld(){this.pageNumber++,this.router.navigate(["main",this.pageNumber])}ngOnDestroy(){}static \u0275fac=function(e){return new(e||i)(s(O),s(V),s(T),s(M),s(N))};static \u0275cmp=g({type:i,selectors:[["app-main"]],viewQuery:function(e,o){if(e&1&&P(v,5),e&2){let n;S(n=w())&&(o.textarea=n.first)}},standalone:!0,features:[y],decls:6,vars:3,consts:[["textarea",""],[1,"container"],[3,"placeholderText","disablePostButton"],[1,"text-area-p"],[1,"spinner","center-block"],[3,"sendText","placeholderText","disablePostButton"],["aria-busy","true"],[3,"list","showSeperator"],[2,"display","flex","justify-content","space-between"],[3,"click","disabled"]],template:function(e,o){e&1&&(a(0,"div",1),C(1,j,2,2,"app-textarea",2)(2,B,2,0,"p",3)(3,R,2,0)(4,k,1,0,"div",4)(5,D,6,4),l()),e&2&&(r(),u(o._authService.userdata()?1:2),r(2),u(o.showProgress?3:-1),r(),u(o.loading?4:5))},dependencies:[A,v],styles:["button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:auto}"]})};export{I as MainComponent};
